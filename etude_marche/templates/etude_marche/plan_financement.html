{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Plan de Financement - {{ projet }}</title>
    <style>
        @page { size: A4; margin: 50px 30px 70px 30px; }
        body { font-family: Arial, sans-serif; color: #333; }
        header { position: fixed; top: -40px; left: 0; right: 0; height: 50px; text-align: center; }
        header img { height: 40px; }
        footer { position: fixed; bottom: -50px; left: 0; right: 0; height: 40px;
                 text-align: center; font-size: 12px; color: #555; }
        h1, h2, h3 { color: #2C3E50; margin-bottom: 5px; }
        .section { background-color: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 20px;
                   box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .charts { display: flex; flex-wrap: wrap; gap: 15px; justify-content: space-between; }
        .chart-container { flex: 1 1 48%; max-width: 48%; text-align: center; margin-bottom: 15px; }
        img { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 5px; background: #fff; padding: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        th, td { padding: 6px 10px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #2980B9; color: white; }
        .section-title { background-color: #3498DB; color: white; padding: 5px 10px; border-radius: 5px; margin-bottom: 10px; }

        /* --- Boutons PDF / CSV --- */
        .download-buttons { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:20px; justify-content:center; }
        .download-buttons a { display:flex; align-items:center; padding:10px 20px; border-radius:8px;
                               color:white; font-weight:bold; text-decoration:none; transition:opacity 0.3s; }
        .download-buttons a.pdf { background-color:#2980B9; }
        .download-buttons a.csv { background-color:#27AE60; }
        .download-buttons a span { margin-right:8px; }
        .download-buttons a:hover { opacity:0.85; }

        @media (max-width:600px) {
            .download-buttons { flex-direction: column; align-items: stretch; }
            .download-buttons a { justify-content:center; }
        }
    </style>
</head>
<body>

<header>
    <img src="{{ logo_url }}" alt="Logo">
    <h2>{{ projet }}</h2>
</header>

<footer>
    Page <pdf:pagenumber> / <pdf:pagecount>
</footer>

<main>

    <!-- --- Boutons de t√©l√©chargement --- -->
    <div class="download-buttons">
        <a href="{% url 'generate_pdf_or_csv' %}" class="pdf"><span>üìÑ</span>T√©l√©charger PDF</a>
        <a href="{% url 'generate_pdf_or_csv' %}?format=csv" class="csv"><span>üìä</span>T√©l√©charger CSV</a>
    </div>

    <h1>{{ projet }}</h1>
    <p><strong>Date de lancement :</strong> {{ date_lancement }}</p>
    <p><strong>Type de transport :</strong> {{ transport_type }}</p>
    <p><strong>Villes de d√©part :</strong> {{ villes_depart|join:", " }}</p>
    <p><strong>Villes d'arriv√©e :</strong> {{ villes_arrivee|join:", " }}</p>
    <p><strong>Clients cibl√©s :</strong> {{ clients }}</p>

    <div class="section">
        <div class="section-title"><h2>Graphiques de l'√©tude</h2></div>
        <div class="charts">
            <div class="chart-container">
                <h3>Participants par ville</h3>
                {% if ville_chart %}
                    <img src="data:image/png;base64,{{ ville_chart }}">
                {% else %}
                    <p>Aucune donn√©e disponible.</p>
                {% endif %}
            </div>
            <div class="chart-container">
                <h3>Fr√©quence de voyage</h3>
                {% if freq_chart %}
                    <img src="data:image/png;base64,{{ freq_chart }}">
                {% else %}
                    <p>Aucune donn√©e disponible.</p>
                {% endif %}
            </div>
            <div class="chart-container">
                <h3>Budget moyen par ville</h3>
                {% if budget_chart %}
                    <img src="data:image/png;base64,{{ budget_chart }}">
                {% else %}
                    <p>Aucune donn√©e disponible.</p>
                {% endif %}
            </div>
            <div class="chart-container">
                <h3>Type de colis</h3>
                {% if type_colis_chart %}
                    <img src="data:image/png;base64,{{ type_colis_chart }}">
                {% else %}
                    <p>Aucune donn√©e disponible.</p>
                {% endif %}
            </div>
            <div class="chart-container">
                <h3>Services souhait√©s</h3>
                {% if services_chart %}
                    <img src="data:image/png;base64,{{ services_chart }}">
                {% else %}
                    <p>Aucune donn√©e disponible.</p>
                {% endif %}
            </div>
            <div class="chart-container">
                <h3>Moyens de paiement</h3>
                {% if paiement_chart %}
                    <img src="data:image/png;base64,{{ paiement_chart }}">
                {% else %}
                    <p>Aucune donn√©e disponible.</p>
                {% endif %}
            </div>
            <div class="chart-container">
                <h3>Sensibilit√© au prix</h3>
                {% if sensibilite_chart %}
                    <img src="data:image/png;base64,{{ sensibilite_chart }}">
                {% else %}
                    <p>Aucune donn√©e disponible.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title"><h2>R√©sum√© des r√©ponses</h2></div>
        <table style="width:100%; border-collapse: collapse; font-size:10px; table-layout:fixed;">
        <thead>
            <tr>
                <th style="width:6%;">Pr√©nom</th>
                <th style="width:6%;">Nom</th>
                <th style="width:4%;">√Çge</th>
                <th style="width:4%;">Sexe</th>
                <th style="width:7%;">Ville</th>
                <th style="width:10%;">Email</th>
                <th style="width:7%;">T√©l√©phone</th>
                <th style="width:10%;">Adresse postale</th>
                <th style="width:8%;">Int√©r√™t transport</th>
                <th style="width:4%;">Fr√©quence</th>
                <th style="width:5%;">Budget (FCFA)</th>
                <th style="width:5%;">Type de colis</th>
                <th style="width:8%;">Services souhait√©s</th>
                <th style="width:6%;">Moyen de paiement</th>
                <th style="width:6%;">Sensibilit√© au prix</th>
            </tr>
        </thead>
        <tbody>
            {% for r in reponses %}
            <tr>
                <td style="word-wrap: break-word;">{{ r.prenom }}</td>
                <td style="word-wrap: break-word;">{{ r.nom }}</td>
                <td>{{ r.age }}</td>
                <td>{{ r.sexe }}</td>
                <td style="word-wrap: break-word;">{{ r.ville }}</td>
                <td style="word-wrap: break-word;">{{ r.email }}</td>
                <td>{{ r.telephone }}</td>
                <td style="word-wrap: break-word;">{{ r.adresse_postale }}</td>
                <td style="word-wrap: break-word;">{{ r.interet_transport }}</td>
                <td>{{ r.frequence_voyage }}</td>
                <td>{{ r.budget }}</td>
                <td>{{ r.type_colis }}</td>
                <td style="word-wrap: break-word;">{{ r.services_souhaites }}</td>
                <td>{{ r.moyen_paiement }}</td>
                <td>{{ r.sensibilite_prix }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="15">Aucune r√©ponse disponible.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

</main>

</body>
</html>
